Parameters:
    EnvironmentName:
        Type: String

    VpcCIDR:
        Type: String

    PublicSubnet1aCIDR:
        Type: String

    PrivateSubnet1aCIDR:
        Type: String

Resources:
    VPC:
        Type: AWS::EC2::VPC
        Properties:
            CidrBlock: !Ref VpcCIDR
            EnableDnsHostnames: true
            Tags:
                -
                    Key: "Environment"
                    Value: !Ref EnvironmentName

    InternetGateway:
        Type: AWS::EC2::InternetGateway
        Properties:
            Tags:
                -
                    Key: "Environment"
                    Value: !Ref EnvironmentName

    InternetGatewayAttachment:
        Type: AWS::EC2::VPCGatewayAttachment
        Properties:
            VpcId: !Ref VPC
            InternetGatewayId: !Ref InternetGateway

    PublicSubnet1a:
        Type: AWS::EC2::Subnet
        Properties:
            VpcId: !Ref VPC
            CidrBlock: !Ref PublicSubnet1aCIDR
            AvailabilityZone: !Select [ "0", !GetAZs "" ]
            Tags:
                -
                    Key: "Environment"
                    Value: !Ref EnvironmentName
                -
                    Key: "Visibility"
                    Value: "Public"

    PrivateSubnet1a:
        Type: AWS::EC2::Subnet
        Properties:
            VpcId: !Ref VPC
            CidrBlock: !Ref PrivateSubnet1aCIDR
            AvailabilityZone: !Select [ "0", !GetAZs "" ]
            Tags:
                -
                    Key: "Environment"
                    Value: !Ref EnvironmentName
                -
                    Key: "Visibility"
                    Value: "Private"

    PublicRouteTable:
        Type: AWS::EC2::RouteTable
        Properties:
            VpcId: !Ref VPC
            Tags:
                -
                    Key: "Environment"
                    Value: !Ref EnvironmentName
                -
                    Key: "Visibility"
                    Value: "Public"

    DefaultPublicRoute:
        Type: AWS::EC2::Route
        DependsOn: InternetGateway
        Properties:
            RouteTableId: !Ref PublicRouteTable
            DestinationCidrBlock: 0.0.0.0/0
            GatewayId: !Ref InternetGateway

    DefaultPublicRouteTableAssociation:
        Type: AWS::EC2::SubnetRouteTableAssociation
        Properties:
            SubnetId: !Ref PublicSubnet1a
            RouteTableId: !Ref PublicRouteTable

    PrivateRouteTable:
        Type: AWS::EC2::RouteTable
        Properties:
            VpcId: !Ref VPC
            Tags:
                -
                    Key: "Environment"
                    Value: !Ref EnvironmentName
                -
                    Key: "Visibility"
                    Value: "Private"

Outputs:
    StackVPC:
        Value: !Ref VPC
        Export:
            Name: !Sub "${EnvironmentName}-VPCID"
